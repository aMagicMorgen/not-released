## class MDHParser - Как это работает

### MDH  - Markdown Hybrid Text

**Извлечение блоков**: Парсер сканирует содержимое, находя блоки в формате `<!--ТИП параметры-->содержимое<!--/ТИП-->`, и извлекает их в порядке следования.

**Обработка обычного содержимого**: Любой контент вне этих блоков помечается как "RAW" (сырой) и включается в результат без изменений.

**Обработка блоков**: Каждый блок обрабатывается в соответствии со своим типом:
- Встроенные типы (MDS, MCSS, PUG) обрабатываются стандартными парсерами
- Для других типов блоков можно зарегистрировать пользовательские обработчики
- Блоки неизвестных типов включаются как сырое содержимое

**Сборка результата**: Результаты обработки всех блоков объединяются в исходном порядке для формирования итогового HTML.

## Настройка и расширение

Вы можете расширить функциональность парсера:
1. Добавляя дополнительные встроенные парсеры
2. Регистрируя пользовательские обработчики для конкретных типов блоков
3. Изменяя шаблон извлечения для работы с другими форматами блоков
4. Добавляя этапы предварительной или последующей обработки

Парсер сохраняет исходный порядок всех блоков контента и корректно обрабатывает PHP-код внутри содержимого (поскольку PHP выполняется до работы парсера).

# Документация MDH Parser

## Описание

MDH Parser - это PHP-класс для обработки гибридных Markdown-документов (MDH - Markdown Hybrid), которые могут содержать:
- Обычный HTML/текст
- Блоки Markdown (MDS)
- Блоки MCSS (стили)
- Блоки PUG (шаблоны)
- Любые другие пользовательские блоки

Парсер сохраняет порядок блоков и обрабатывает каждый тип содержимого соответствующим образом.

## Основные методы

### `registerParser(string $blockType, callable $parserCallback)`
Регистрирует пользовательский обработчик для определенного типа блока.

**Параметры:**
- `$blockType` - тип блока (например, 'CUSTOM')
- `$parserCallback` - функция обработки, принимает содержимое блока и параметры

### `parseString(string $content)`
Парсит MDH-контент из строки.

### `parseFile(string $filePath)`
Парсит MDH-контент из файла.

## Встроенные обработчики

- **MDS** - Markdown (использует Parsedown)
- **MCSS** - Стили (оборачивает в `<style>`)
- **PUG** - Шаблоны Pug (заглушка)
- **RAW** - Необработанный HTML/текст

## Примеры использования

### Базовый пример

```php
require 'vendor/autoload.php';
use Parsedown;

$mdh = new MDHParser();

$content = <<<MDH
<!--MDS
# Заголовок Markdown
Это **Markdown** текст
/MDS-->

<div>Обычный HTML</div>

<!--MCSS
body { color: #333; }
/MCSS-->
MDH;

$result = $mdh->parseString($content);
echo $result;
```

### Работа с файлами

```php
$mdh = new MDHParser();
$html = $mdh->parseFile('document.mdh');
file_put_contents('output.html', $html);
```

### Пользовательские обработчики

```php
$mdh = new MDHParser();

// Регистрируем обработчик для кастомного блока
$mdh->registerParser('CUSTOM', function($content, $params) {
    return "<div class='custom-block' data-params='{$params}'>"
         . strtoupper($content)
         . "</div>";
});

$content = <<<MDH
<!--CUSTOM param1 param2
Это будет обработано кастомным обработчиком
/CUSTOM-->
MDH;

echo $mdh->parseString($content);
```

### Комбинированный пример

```php
$mdh = new MDHParser();

// Кастомный обработчик для CSV данных
$mdh->registerParser('CSV', function($content) {
    $lines = explode("\n", trim($content));
    $html = '<table>';
    foreach ($lines as $line) {
        $html .= '<tr><td>' 
               . implode('</td><td>', str_getcsv($line)) 
               . '</td></tr>';
    }
    return $html . '</table>';
});

$content = <<<MDH
<!--MDS
# Отчет
Ниже представлены данные:
/MDS-->

<!--CSV
Имя,Возраст,Город
Анна,25,Москва
Иван,30,Санкт-Петербург
/CSV-->

<script>
// Обычный JavaScript
console.log('MDH rocks!');
</script>
MDH;

file_put_contents('report.html', $mdh->parseString($content));
```

## Формат MDH-документа

Блоки определяются следующим образом:

```
<!--TYPE параметры
содержимое блока
/TYPE-->
```

Где:
- `TYPE` - тип блока (MDS, MCSS, PUG и т.д.)
- `параметры` - необязательные параметры блока
- `содержимое блока` - текст для обработки

Все, что не заключено в такие блоки, считается "сырым" (RAW) содержимым и включается в вывод без изменений.

## Советы по использованию

1. Для обработки Markdown рекомендуется установить библиотеку Parsedown:
   ```
   composer require erusev/parsedown
   ```

2. Для сложных обработчиков выносите логику в отдельные классы.

3. MDH-файлы могут содержать PHP-код, который будет выполнен до обработки:
   ```php
   <?php $date = date('Y-m-d'); ?>
   <!--MDS
   Отчет за <?= $date ?>
   /MDS-->
   ```

4. Используйте пользовательские обработчики для специализированных форматов данных.
