–ø–æ—Å–º–æ—Ç—Ä–∏ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π, –∫–∞–∫ —Ç–≤–æ–π –ø–∞—Ä—Å–µ—Ä —Å–º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å —ç—Ç–æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≥–¥–µ –≤ mdsl .class –±—É–¥–µ—Ç –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –º–∞—Å—Å–∏–≤–∞ –≤ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è dsl. –ú–µ—Ç–∫–∞ –≤ <!--mdsl dsl--> –¥–∞—ë—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –µ—Å—Ç—å dsl –±–ª–æ–∫
```

<!--dsl-->
div
    base = transition-all
    container = max-w-6xl mx-auto px-4
    card = bg-white rounded-lg shadow p-4
    card.primary = bg-blue-100 border-l-4 border-blue-500
    card.warning = bg-yellow-100 border-l-4 border-yellow-500

button
    base = px-4 py-2 rounded
    primary = bg-blue-500 text-white hover:bg-blue-600
    outline = border border-blue-500 text-blue-500 hover:bg-blue-50
<!--/dsl-->

<!--mdsl dsl-->
<0 div.container>
  <1 div.card.primary> –ö–∞—Ä—Ç–æ—á–∫–∞
    <2 button.primary> –ö–Ω–æ–ø–∫–∞
<!--/mdsl-->

```

–†–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞—à–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º, –≥–¥–µ –∫–ª–∞—Å—Å—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ DSL-–±–ª–æ–∫–∞. –í–æ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ—à–µ–Ω–∏–µ:

---

### **1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ MDSL**
```markdown
<!--dsl-->  
[DSL-–±–ª–æ–∫ —Å –∫–ª–∞—Å—Å–∞–º–∏]  
<!--/dsl-->

<!--mdsl dsl-->  
[–†–∞–∑–º–µ—Ç–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª–∞—Å—Å–æ–≤ –∏–∑ DSL]  
<!--/mdsl-->
```

---

### **2. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞**

#### **a) –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ DSL-–ø—Ä–∞–≤–∏–ª**
–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ DSL-–±–ª–æ–∫–∞:
```php
private static function parseDSL(string $content): array {
    preg_match('/<!--dsl-->(.*?)<!--\/dsl-->/s', $content, $matches);
    $dsl = [];
    $currentTag = null;

    foreach (preg_split('/\r?\n/', trim($matches[1])) as $line) {
        if (empty(trim($line))) continue;

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–≥ (div, button –∏ —Ç.–¥.)
        if (!preg_match('/^\s/', $line)) {
            $currentTag = trim($line);
            $dsl[$currentTag] = [];
            continue;
        }

        // –ü–∞—Ä—Å–∏–º –∫–ª–∞—Å—Å—ã (base, card.primary –∏ —Ç.–¥.)
        if (preg_match('/^\s+([\w\.]+)\s*=\s*(.+)/', $line, $m)) {
            $dsl[$currentTag][trim($m[1])] = trim($m[2]);
        }
    }

    return $dsl;
}
```

#### **b) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è DSL –≤ –ø–∞—Ä—Å–µ—Ä**
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∞—Å—Å–æ–≤:
```php
private static function processTag(string $tagStr, array $dsl): array {
    preg_match('/
        ^([a-z]+)          # –¢–µ–≥ (div)
        (?:\s+\.([\w-]+))? # –ö–ª–∞—Å—Å (.container)
    /xi', $tagStr, $parts);

    $tag = $parts[1];
    $classKey = $parts[2] ?? '';

    // –ë–µ—Ä—ë–º –∫–ª–∞—Å—Å –∏–∑ DSL
    $class = '';
    if ($classKey && isset($dsl[$tag][$classKey])) {
        $class = ' class="' . $dsl[$tag][$classKey] . '"';
    }

    return [
        'tag' => $tag,
        'attrs' => $class
    ];
}
```

---

### **3. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏**
```php
public static function compile(string $content): string {
    // 1. –ò–∑–≤–ª–µ–∫–∞–µ–º DSL-–ø—Ä–∞–≤–∏–ª–∞
    $dsl = self::parseDSL($content);

    // 2. –ò–∑–≤–ª–µ–∫–∞–µ–º MDSL-—Ä–∞–∑–º–µ—Ç–∫—É
    preg_match('/<!--mdsl dsl-->(.*?)<!--\/mdsl-->/s', $content, $matches);
    $mdsl = trim($matches[1]);

    // 3. –ü–∞—Ä—Å–∏–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º DSL
    $html = '';
    $lines = explode("\n", $mdsl);
    $stack = [];

    foreach ($lines as $line) {
        if (preg_match('/^<(\d+)\s+([^>]+)>(.*)/', $line, $matches)) {
            $level = (int)$matches[1];
            $tagData = self::processTag($matches[2], $dsl);
            $text = $matches[3];

            // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–æ–≤ –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
            while (!empty($stack) && end($stack)['level'] >= $level) {
                $html .= '</' . array_pop($stack)['tag'] . '>';
            }

            $html .= "<{$tagData['tag']}{$tagData['attrs']}>{$text}";
            $stack[] = ['tag' => $tagData['tag'], 'level' => $level];
        }
    }

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç–µ–≥–∏
    while (!empty($stack)) {
        $html .= '</' . array_pop($stack)['tag'] . '>';
    }

    return $html;
}
```

---

### **4. –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã**
#### **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```markdown
<!--dsl-->
div
    container = max-w-6xl mx-auto px-4
    card.primary = bg-blue-100 border-l-4 border-blue-500
button
    primary = bg-blue-500 text-white
<!--/dsl-->

<!--mdsl dsl-->
<0 div.container>
  <1 div.card.primary> –ö–∞—Ä—Ç–æ—á–∫–∞
    <2 button.primary> –ö–Ω–æ–ø–∫–∞
<!--/mdsl-->
```

#### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```html
<div class="max-w-6xl mx-auto px-4">
  <div class="bg-blue-100 border-l-4 border-blue-500">–ö–∞—Ä—Ç–æ—á–∫–∞
    <button class="bg-blue-500 text-white">–ö–Ω–æ–ø–∫–∞</button>
  </div>
</div>
```

---

### **5. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–∑–º–µ—Ç–∫–∏**  
   - DSL-–±–ª–æ–∫ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏  
   - MDSL-–±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É  

2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤**  
   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Å—Ç—ã–µ –∫–ª–∞—Å—Å—ã (`.container`), —Ç–∞–∫ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (`.card.primary`)

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–æ–≤**  
   –£—Ä–æ–≤–Ω–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (`<0`, `<1`, `<2`) —É–ø—Ä–∞–≤–ª—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π DOM

---

### **6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è**
**–¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `.card.primary` ‚Üí –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ `card primary`)
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ DSL –∫–ª–∞—Å—Å—ã

**–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ DSL-–ø—Ä–∞–≤–∏–ª
2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:
   ```dsl
   card.error : card.primary
      border-color = red-500
   ```
3. –ò–º–ø–æ—Ä—Ç –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤:
   ```markdown
   <!--dsl-->
   import "buttons.dsl"
   <!--/dsl-->
   ```

---

### **7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∞—à–∏–º –ø–∞—Ä—Å–µ—Ä–æ–º**
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∞—à –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å `#id name .class | attrs`, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º `processTag()`:
```php
preg_match('/
    ^([a-z]+)          # –¢–µ–≥
    (?:\s+#([\w-]+))?  # ID
    (?:\s+([\w-]+))?   # Name
    (?:\s+\.([\w-]+))? # –ö–ª–∞—Å—Å
    (?:\s+\|(.*))?     # –ê—Ç—Ä–∏–±—É—Ç—ã
/xi', $tagStr, $parts);

// –ë–µ—Ä—ë–º –∫–ª–∞—Å—Å –∏–∑ DSL
$class = '';
if (!empty($parts[4]) && isset($dsl[$parts[1]][$parts[4]])) {
    $class = ' class="' . $dsl[$parts[1]][$parts[4]] . '"';
}
```

---

### **–ò—Ç–æ–≥**
–ú–æ–π –ø–∞—Ä—Å–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–∞—à–∏–º DSL-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º, –µ—Å–ª–∏:
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ DSL-–±–ª–æ–∫–∞  
2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ DSL  
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º —É—Ä–æ–≤–Ω–µ–π –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏  

–ì–æ—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è! üòä

## –¥–∞, —Ä–µ–∞–ª–∏–∑—É–π –∏ —Ä–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ —ç—Ç–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –¥–µ–ª–∞–µ—Ç —Ö–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ–º —Å–∞–º—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É mdsl

–û—Ç–ª–∏—á–Ω–æ! –†–µ–∞–ª–∏–∑—É—é —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –ø–∞—Ä—Å–µ—Ä–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π DSL-—Å—Ç–∏–ª–µ–π –∏ —É–ª—É—á—à–µ–Ω–Ω–æ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é. –í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ—á–µ–º—É —ç—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ:

---

### **1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å MDSL (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)**

#### **–§–∞–π–ª `template.mdsl`**
```markdown
<!--dsl-->
div
    base       = transition-all
    container  = max-w-6xl mx-auto px-4
    card       = bg-white rounded-lg shadow p-4
    card.primary = bg-blue-100 border-l-4 border-blue-500

button
    base     = px-4 py-2 rounded
    primary  = bg-blue-500 text-white hover:bg-blue-600
<!--/dsl-->

<!--mdsl-->
<0 div#main wrapper | data-lang=ru>
  <1 div.container>
    <2 div.card.primary> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç card + primary –∏–∑ DSL -->
      <3 button.primary> –ö–Ω–æ–ø–∫–∞
<!--/mdsl-->
```

---

### **2. –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

#### **a) –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∏ —Ä–∞–∑–º–µ—Ç–∫–∏**  
  DSL-–±–ª–æ–∫ ‚Äî —ç—Ç–æ "—Å—Ç–∏–ª–µ–≤–æ–π –≥–ª–æ—Å—Å–∞—Ä–∏–π", MDSL-–±–ª–æ–∫ ‚Äî "—á–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
  
- **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å**  
  –£—Ä–æ–≤–Ω–∏ `<0 > <1 >` –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤

#### **b) –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**
1. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤**  
   `.card.primary` ‚Üí –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å—Ç–∏–ª–∏ `card` + `primary` –∏–∑ DSL

2. **–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã**  
   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `| data-*=value` –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å DSL

3. **–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ**  
   IDE –º–æ–≥—É—Ç –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –∫–ª–∞—Å—Å—ã –∏–∑ DSL-–±–ª–æ–∫–∞

---

### **3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞**

#### **–ö–ª–∞—Å—Å `MDSLCompiler`**
```php
class MDSLCompiler {
    private static $dsl = [];
    private static $usedIds = [];

    public static function compile(string $content): string {
        // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º DSL-–ø—Ä–∞–≤–∏–ª–∞
        self::$dsl = self::parseDSL($content);
        
        // 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º MDSL-—Ä–∞–∑–º–µ—Ç–∫—É
        return self::parseMDSL($content);
    }

    private static function parseDSL(string $content): array {
        preg_match('/<!--dsl-->(.*?)<!--\/dsl-->/s', $content, $match);
        $lines = preg_split('/\r?\n/', trim($match[1]));
        $dsl = [];
        $currentTag = null;

        foreach ($lines as $line) {
            if (empty(trim($line))) continue;

            // –ù–æ–≤—ã–π —Ç–µ–≥ (div, button)
            if (!preg_match('/^\s/', $line)) {
                $currentTag = trim($line);
                $dsl[$currentTag] = ['base' => ''];
                continue;
            }

            // –ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–∏–ª–µ–π (card.primary = ...)
            if (preg_match('/^\s+([\w\.]+)\s*=\s*(.+)/', $line, $m)) {
                $dsl[$currentTag][trim($m[1])] = trim($m[2]);
            }
        }

        return $dsl;
    }

    private static function parseMDSL(string $content): string {
        preg_match('/<!--mdsl-->(.*?)<!--\/mdsl-->/s', $content, $match);
        $lines = explode("\n", trim($match[1]));
        $html = '';
        $stack = [];

        foreach ($lines as $line) {
            if (preg_match('/^<(\d+)\s+([^>]+)>\s*(.*)/', $line, $m)) {
                [$_, $level, $tagStr, $text] = $m;
                $html .= self::processTag($level, $tagStr, $text, $stack);
            }
        }

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç–µ–≥–∏
        while (!empty($stack)) {
            $html .= '</' . array_pop($stack)['tag'] . '>';
        }

        return $html;
    }

    private static function processTag(int $level, string $tagStr, string $text, array &$stack): string {
        // –ü–∞—Ä—Å–∏–º —Ç–µ–≥, id, name, –∫–ª–∞—Å—Å—ã –∏ –∞—Ç—Ä–∏–±—É—Ç—ã
        preg_match('/
            ^([a-z]+)               # –¢–µ–≥
            (?:#([\w-]+))?          # ID
            (?:\s+([\w-]+))?        # Name
            (?:\s+\.([\w\.-]+))?    # –ö–ª–∞—Å—Å—ã (card.primary)
            (?:\s+\|\s*(.*))?       # –ê—Ç—Ä–∏–±—É—Ç—ã
        /xi', $tagStr, $parts);

        [$_, $tag, $id, $name, $classKey, $rawAttrs] = $parts + array_fill(0, 6, null);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è ID
        if ($id && isset(self::$usedIds[$id])) {
            throw new Exception("Duplicate ID: #$id");
        }
        self::$usedIds[$id] = true;

        // –°–æ–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã –∏–∑ DSL
        $classes = [];
        if ($classKey) {
            foreach (explode('.', $classKey) as $key) {
                if (isset(self::$dsl[$tag][$key])) {
                    $classes[] = self::$dsl[$tag][$key];
                }
            }
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º HTML-–∞—Ç—Ä–∏–±—É—Ç—ã
        $attrs = [];
        if ($id) $attrs['id'] = $id;
        if ($name) $attrs['name'] = $name;
        if ($classes) $attrs['class'] = implode(' ', $classes);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã
        if ($rawAttrs) {
            preg_match_all('/(\w+)=([^\s]+)/', $rawAttrs, $attrMatches);
            foreach ($attrMatches[1] as $i => $key) {
                $attrs[$key] = trim($attrMatches[2][$i], '"\'');
            }
        }

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–≥–∏ –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
        $html = '';
        while (!empty($stack) && end($stack)['level'] >= $level) {
            $html .= '</' . array_pop($stack)['tag'] . '>';
        }

        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–µ–≥
        $html .= "<$tag";
        foreach ($attrs as $k => $v) {
            $html .= " $k=\"$v\"";
        }
        $html .= ">$text";

        $stack[] = ['tag' => $tag, 'level' => $level];
        return $html;
    }
}
```

---

### **4. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞**

#### **a) –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å—Ç–∏–ª–µ–π**  
  –ò–∑–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å—ã –≤ DSL ‚Äî –æ–Ω–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- **–ü–æ–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**  
  –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏, –≥–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `.card.primary`

#### **b) –î–ª—è –≤–µ—Ä—Å—Ç–∫–∏**
```markdown
<0 div.container>        <!-- max-w-6xl mx-auto px-4 -->
  <1 div.card.primary>   <!-- bg-white rounded-lg + bg-blue-100 -->
    <2 button.primary>   <!-- px-4 py-2 rounded + bg-blue-500 -->
```

#### **c) –î–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**  
  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π –∏–∑ DSL
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫**  
  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–ª–∞—Å—Å–∞—Ö

---

### **5. –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞**

#### **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```markdown
<!--dsl-->
div
    container = mx-auto p-4
    bordered  = border-2
<!--/dsl-->

<!--mdsl-->
<0 div#app wrapper | data-version=1.0>
  <1 div.container.bordered>
    –ö–æ–Ω—Ç–µ–Ω—Ç
<!--/mdsl-->
```

#### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```html
<div id="app" name="wrapper" data-version="1.0">
  <div class="mx-auto p-4 border-2">–ö–æ–Ω—Ç–µ–Ω—Ç</div>
</div>
```

---

### **6. –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?**
1. **–°–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫**  
   –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—á–∞—Ç–∞—Ç—å—Å—è –≤ –∫–ª–∞—Å—Å–µ ‚Äî –æ–Ω–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ DSL

2. **–ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**  
   –ú–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

3. **–ß–∏—Å—Ç–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞**  
   –ù–∏–∫–∞–∫–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –≤ –∫–æ–¥–µ

---

### **7. –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ**
1. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º**  
   ```dsl
   [dark]
   button.primary = bg-gray-800
   ```
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tailwind**  
   –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è DSL –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ Tailwind
3. **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä**  
   –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
