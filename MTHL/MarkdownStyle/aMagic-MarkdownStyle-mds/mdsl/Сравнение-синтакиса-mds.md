–û—Ç–ª–∏—á–Ω–æ, —Ä–∞–∑–±–µ—Ä—ë–º –æ—Ç–ª–∏—á–∏—è –≤–∞—à–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –º–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç–∞. –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –≤—ã–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.

---

### **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–≤**

#### –í–∞—à –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (`v1`):
```markdown
<0 div #id name .class1.class2 | attr1="val1" attr2="val2"> –¢–µ–∫—Å—Ç
```
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
1. `#id`  
2. `name`  
3. `.class1.class2`  
4. `|` –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å  
5. –ê—Ç—Ä–∏–±—É—Ç—ã –≤ –∫–∞–≤—ã—á–∫–∞—Ö  

#### –ú–æ–π –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (`v2`):
```markdown
<0 div.class1.class2#id name[attr1=val1 attr2=val2]> –¢–µ–∫—Å—Ç
```
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
1. `.class`  
2. `#id`  
3. `name`  
4. `[...]` –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤  
5. –ê—Ç—Ä–∏–±—É—Ç—ã –±–µ–∑ –∫–∞–≤—ã—á–µ–∫  

---

### **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–∏–π**

#### 1. –ü–æ—Ä—è–¥–æ–∫ `#id`, `name`, `.class`
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –í–∞—à —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`v1`) | –ú–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`v2`) | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–∞—Ä—Å–µ—Ä |
|----------|----------------------|----------------------|-------------------|
| **–ì–∏–±–∫–æ—Å—Ç—å** | –ñ—ë—Å—Ç–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ (`#` ‚Üí `name` ‚Üí `.`) | –ì–∏–±–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ (–º–æ–∂–Ω–æ `#id.name` –∏–ª–∏ `.name#id`) | –í–∞—à –ø–∞—Ä—Å–µ—Ä –ø—Ä–æ—â–µ, –Ω–æ –º–µ–Ω–µ–µ –≥–∏–±–æ–∫ |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** | –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞–º–∏ (`#`, `.`, `|`) | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–∞–º–∏/—Å–∫–æ–±–∫–∞–º–∏ | –í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–µ–µ |
| **–ü–∞—Ä—Å–µ—Ä** | –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–≥—É–ª—è—Ä–∫–∞ (`/(#\w+)\s+(\w+)\s+(\.\w+)/`) | –°–ª–æ–∂–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∫–∞ (–Ω—É–∂–µ–Ω lookahead) | –í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç –ª–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å |

#### 2. –§–æ—Ä–º–∞—Ç –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (`|` vs `[...]`)
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –í–∞—à —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`v1`) | –ú–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`v2`) | –í–ª–∏—è–Ω–∏–µ |
|----------|----------------------|----------------------|--------|
| **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å** | –ß—ë—Ç–∫–∏–π —Å–∏–º–≤–æ–ª `|` | –°–∫–æ–±–∫–∏ `[...]` | `|` —É–¥–æ–±–Ω–µ–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ |
| **–ö–∞–≤—ã—á–∫–∏** | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã (`attr="value"`) | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã (`attr=value`) | –í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç —Å—Ç—Ä–æ–∂–µ |
| **–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ü—Ä–æ—â–µ (–∫–∞–≤—ã—á–∫–∏ –∫–∞–∫ –≥—Ä–∞–Ω–∏—Ü—ã) | –°–ª–æ–∂–Ω–µ–µ (–Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –ø—Ä–æ–±–µ–ª—ã) | –í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞–¥—ë–∂–Ω–µ–µ |

---

### **–ê–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏**
1. **–ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤**  
   - –ù–µ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞:  
     - –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞  
     - –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–µ—Ä–∞  
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—à –ø–æ—Ä—è–¥–æ–∫ (`#id` ‚Üí `name` ‚Üí `.class`) –ª–æ–≥–∏—á–Ω–µ–µ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

2. **–§–æ—Ä–º–∞—Ç –∞—Ç—Ä–∏–±—É—Ç–æ–≤**  
   - `|` vs `[...]` ‚Äî —ç—Ç–æ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ –æ—Ç–ª–∏—á–∏–µ:  
     - `|` —è–≤–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç "—Å—Ç—Ä—É–∫—Ç—É—Ä—É" –∏ "–∞—Ç—Ä–∏–±—É—Ç—ã"  
     - `[...]` –±–ª–∏–∂–µ –∫ HTML-—Å—Ç–∏–ª—é  
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç —Å `|` –ª—É—á—à–µ –¥–ª—è DSL, —Ç–∞–∫ –∫–∞–∫:  
     - –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π  
     - –ú–µ–Ω—å—à–µ ambiguity (–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏) –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ  

---

### **–ö–∞–∫ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–π –ø–∞—Ä—Å–µ—Ä –ø–æ–¥ –≤–∞—à —Å–∏–Ω—Ç–∞–∫—Å–∏—Å?**
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **–†–µ–≥—É–ª—è—Ä–∫–∞ –¥–ª—è —Ç–µ–≥–∞**:
   ```php
   preg_match('/
       ^([a-z]+)         # –¢–µ–≥
       (?:\s+#([\w-]+))? # ID
       (?:\s+(\w+))?     # Name
       (?:\s+([\.\w-]+))?# –ö–ª–∞—Å—Å—ã
       (?:\s+\|)?        # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
   /xi', $tagStr, $parts);
   ```
2. **–ü–∞—Ä—Å–µ—Ä –∞—Ç—Ä–∏–±—É—Ç–æ–≤**:
   ```php
   // –í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç (—Å –∫–∞–≤—ã—á–∫–∞–º–∏)
   preg_match_all('/(\w+)="([^"]+)"/', $attrStr, $matches);
   ```

---

### **–ü—Ä–∏–º–µ—Ä –≤–∞—à–µ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤ –º–æ—ë–º –ø–∞—Ä—Å–µ—Ä–µ**
```php
private static function parseTagV1(string $tagStr): array {
    preg_match('/
        ^([a-z]+)          # –¢–µ–≥
        (?:\s+#([\w-]+))?  # ID
        (?:\s+(\w+))?      # Name
        (?:\s+([\.\w-]+))? # –ö–ª–∞—Å—Å—ã
        (?:\s+\|(.*))?     # –ê—Ç—Ä–∏–±—É—Ç—ã
    /xi', $tagStr, $parts);

    return [
        'tag' => $parts[1],
        'id' => $parts[2] ?? null,
        'name' => $parts[3] ?? null,
        'classes' => $parts[4] ? explode('.', substr($parts[4], 1)) : [],
        'attrs' => self::parseAttrsV1($parts[5] ?? '')
    ];
}
```

---

### **–í—ã–≤–æ–¥—ã**
1. **–í–∞—à —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`v1`) –ª—É—á—à–µ** –¥–ª—è:  
   - –ß—ë—Ç–∫–æ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã  
   - –ü—Ä–æ—Å—Ç–æ—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞  
   - –û–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏)  

2. **–ú–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (`v2`) —Å—Ç–æ–∏—Ç –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è** –≤ –ø–æ–ª—å–∑—É:  
   - –ñ—ë—Å—Ç–∫–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ `#id` ‚Üí `name` ‚Üí `.class`  
   - –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è `|` –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤  

3. **–ì–∏–±—Ä–∏–¥–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç**:  
   –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

–¢–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –ø–∞—Ä—Å–µ—Ä ‚Äî –ø—Ä–∏—à–ª–∏—Ç–µ –µ–≥–æ –∫–æ–¥, —á—Ç–æ–±—ã –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏! üòä
